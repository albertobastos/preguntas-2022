<!DOCTYPE html>
<html>
  <meta charset="utf-8" />
  <head>
    <title>Examinador 2.0</title>
  </head>
  <style type="text/css">
  </style>
</html>

<div id="nojs">
  Sin JavaScript hay poco que hacer, que no cobro por esto.
</div>

<div id="outer" style="display: none;">
  <h1>Examinador 2.0</h1>
  <div id="config">
    <p>Elige qué temas incluir:</p>
    <ul>
      <li><button >Seleccionar todos</button></li>
    </ul>
    <ul id="config-chapters">
      <!--li>
        <input type="checkbox" name="config-chapter-X" checked="checked" />
        <button>Tema N.</button> Bla bla bla bla. <span>(N preguntas)</span>
      </li-->
    </ul>
    <ul>
      <li><input type="checkbox" id="config-shuffle" /> Barajar respuestas</li>
      <li>Cuántas preguntas: <input type="text" id="config-amount" />
        <span>(máx: N)</span></li>
    </ul>
    <button>Empezar</button>
  </div>
  <div id="exam">
    <div id="exam-stats">
      <ul>
        <li>Aciertos: <span>N</span></li>
        <li>Fallos: <span>N</span></li>
        <li>Sin contestar: <span>N</span></li>
        <li>Nota (sobre 60): <span>N</span></li>
        <li>Nota (sobre 10): <span>N</span></li>
      </ul>
      <ul>
        <li><button>Nuevo examen</button></li>
        <li><button>Ver solo fallos</button></li>
        <li><button>Exportar seleccionadas</button></li>
        <li><button>Repetir fallos</button></li>
        <li><button>Estadísticas</button></li>
      </ul>
    </div>
    <div id="exam-sheet">
        <div>
          <p>
            <input type="checkbox" name="exam-question-N" /><span>N. </span>
            <span>Bla bla bla bla bla</span>
          </p>
          <ul>
            <li><button>a) foo</button></li>
            <li><button>b) bar</button></li>
            <li><button>c) xyx</button></li>
            <li><button>d) culo</button></li>
          </ul>
        </div>
    </div>
  </div>
</div>

<script type="text/javascript">
const DATA = ##DATA##;

/*
DATA [ // un item por tema
  {
    num // int, numeración original del tema
    title // string, nombre del tema
    questions [ // un item por cada pregunta del tema
                // aquí ya solo llegan preguntas que cumplen todo lo
                // necesario para incluirse en un examen
      {
        n // int, numeración original de la pregunta dentro del tema
        a // char, opción (siguiendo orden original) con la respuesta correcta
        q // string, enunciado de la pregunta
        o [ // un item por cada posible respuesta
          {char x} // texto de la respuesta para la opción etiquetada como {x}
                   // en el orden original
        ]
      }
    ]
  }
]
*/

const STATE = {
  view: "config",
  stats: {

  },
  currentExam: {
    questions: []
  }
};

const DOM = {
  nojs: document.getElementById('nojs'),
  outer: document.getElementById('outer'),
  config: {
    chapters: document.getElementById('config-chapters'),
    chapterChecks: () => {
      const checks = [...DOM.config.chapters.getElementsByTagName('input')]
        .filter(input => input.type === "checkbox");
      DOM.config.chapterChecks = () => checks;
      return checks;
    }
  }
};

const handlers = {
  config: {
    selectAll: function() {

    },
    checkChapter: function(checkbox) {

    },
    onlyChapter: function(button) {
      const num = button.getAttribute("data-num");
      DOM.config.chapterChecks().forEach(check => 
        check.checked = check.getAttribute("data-num")===num ? "checked" : "");
    }
  }
};

const helpers = {
  config: {
    reset: function() {
      DATA.forEach(c => {
        helpers.config.addChapter(c.num, c.title, c.questions.length);
      });
    },
    addChapter: function(num, title, nQuestions) {
      const li = document.createElement('li');
      const html = `\
<input
  data-num="${num}"
  type="checkbox"
  checked="checked"
  onclick="handlers.config.checkChapter(this);" />
<button
  data-num="${num}"
  onclick="handlers.config.onlyChapter(this);"
>Tema ${num}.</button> ${title} <span>(${nQuestions} preguntas)</span>`;
      li.innerHTML = html;
      DOM.config.chapters.appendChild(li);
    },
    updateConfigAmountMax: function() {

    }
  }
};

(function init() {
  helpers.config.reset();
  DOM.nojs.style.display = 'none';
  DOM.outer.style.display = '';
})();

</script>